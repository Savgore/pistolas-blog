---
layout: base
---
{% set displayTagList = tags | displayTags %}
{% set firstTag = displayTagList[0] if displayTagList.length > 0 else null %}

<article class="article-wrap">
  <div class="article-meta">
    <time datetime="{{ date | isoDate }}">{{ date | readableDate }}</time>
    {% for tag in displayTagList %}
    <a class="article-meta__tag" href="/tag/{{ tag }}/">{{ tag }}</a>
    {% endfor %}
    <span>{{ content | readingTime }} min read</span>
  </div>

  <h1 class="article-title">{{ title }}</h1>

  {% if description %}
  <p class="article-subtitle">{{ description }}</p>
  {% endif %}

  <hr class="article-rule">

  <div class="prose">
    {{ content | safe }}
  </div>

  {% if firstTag %}
  {% set relatedPosts = collections.posts | byTag(firstTag) | limit(4) %}
  {% set hasRelated = false %}
  {% for post in relatedPosts %}
    {% if post.url != page.url %}{% set hasRelated = true %}{% endif %}
  {% endfor %}

  {% if hasRelated %}
  <div class="related-posts">
    <span class="related-posts__heading">More posts tagged {{ firstTag }}</span>
    <div class="post-list" style="padding: 0;">
    {% set relatedCount = 0 %}
    {% for post in relatedPosts %}
      {% if post.url != page.url and relatedCount < 3 %}
        {% set relatedCount = relatedCount + 1 %}
        {% set title = post.data.title %}
        {% set date = post.date %}
        {% set url = post.url %}
        {% set description = post.data.description %}
        {% set tags = post.data.tags %}
        {% include "partials/post-item.njk" %}
      {% endif %}
    {% endfor %}
    </div>
  </div>
  {% endif %}
  {% endif %}
</article>
